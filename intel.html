<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Management Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FullCalendar CDN -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: #1f2937;
            color: #e5e7eb;
        }
        .light-mode {
            background-color: #f9fafb;
            color: #1f2937;
        }
        #calendar {
            max-width: 900px;
            margin: 20px auto;
        }
        .hidden {
            display: none;
        }
        .error {
            color: #ef4444;
            font-size: 0.875rem;
        }
        .tab-button.active {
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
        }
    </style>
</head>
<body class="light-mode min-h-screen">
    <!-- PIN Login Modal -->
    <div id="pinModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">PIN erforderlich</h2>
            <input id="pinInput" type="password" placeholder="PIN eingeben" class="w-full p-3 border rounded-lg mb-4 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="PIN Eingabe">
            <p id="pinError" class="error hidden mb-4">Falscher PIN oder leere Eingabe.</p>
            <button onclick="checkPin()" class="w-full bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition">Anmelden</button>
        </div>
    </div>

    <!-- Admin PIN Modal -->
    <div id="adminPinModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">Teamleiter PIN</h2>
            <input id="adminPinInput" type="password" placeholder="Admin PIN eingeben" class="w-full p-3 border rounded-lg mb-4 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Admin PIN Eingabe">
            <p id="adminPinError" class="error hidden mb-4">Falscher Admin PIN oder leere Eingabe.</p>
            <button onclick="checkAdminPin()" class="w-full bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition">Bestätigen</button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="container mx-auto p-6 hidden">
        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Team Management Portal</h1>
            <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                <button id="toggleDarkMode" class="bg-gray-200 dark:bg-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">Dark Mode</button>
                <button id="adminAccessBtn" onclick="showAdminPinModal()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">Teamleiter-Zugriff</button>
                <span id="roleIndicator" class="text-sm font-semibold px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700" aria-live="polite">Rolle: Teammitglied</span>
            </div>
        </header>

        <!-- Tabs -->
        <nav class="flex space-x-4 mb-8 border-b border-gray-200 dark:border-gray-700">
            <button onclick="showSection('announcements')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-500 transition active">Ankündigungen</button>
            <button onclick="showSection('teamWarnings')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-500 transition">Team Warns</button>
            <button onclick="showSection('myWarnings')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-500 transition">Meine Warns</button>
            <button onclick="showSection('teamMeeting')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-500 transition">Team Besprechung</button>
            <button onclick="showSection('calendar')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-500 transition">Kalender</button>
        </nav>

        <!-- Announcements Section -->
        <section id="announcements" class="section">
            <h2 class="text-2xl font-bold mb-6">Ankündigungen</h2>
            <div id="announcementList" class="space-y-4"></div>
            <div id="announcementForm" class="mt-6 hidden">
                <textarea id="announcementText" placeholder="Neue Ankündigung" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Ankündigung eingeben"></textarea>
                <button onclick="addAnnouncement()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2">Hinzufügen</button>
            </div>
        </section>

        <!-- Team Warnings Section -->
        <section id="teamWarnings" class="section hidden">
            <h2 class="text-2xl font-bold mb-6">Team Warns</h2>
            <div id="warningList" class="space-y-4"></div>
            <div id="warningForm" class="mt-6 hidden">
                <input id="warningMember" placeholder="Teammitglied" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Teammitglied eingeben">
                <textarea id="warningText" placeholder="Warnung" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Warnung eingeben"></textarea>
                <button onclick="addWarning()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2">Hinzufügen</button>
            </div>
        </section>

        <!-- My Warnings Section -->
        <section id="myWarnings" class="section hidden">
            <h2 class="text-2xl font-bold mb-6">Meine Warns</h2>
            <input id="memberNameInput" placeholder="Deinen Namen eingeben" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Name eingeben">
            <button onclick="showMyWarnings()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Warns anzeigen</button>
            <div id="myWarningList" class="space-y-4 mt-6"></div>
        </section>

        <!-- Team Meeting Section -->
        <section id="teamMeeting" class="section hidden">
            <h2 class="text-2xl font-bold mb-6">Team Besprechung</h2>
            <div id="meetingInfo" class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg"></div>
            <div id="meetingForm" class="mt-6 hidden">
                <input id="meetingDate" type="datetime-local" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Datum und Uhrzeit">
                <input id="meetingLocation" placeholder="Ort" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Ort eingeben">
                <textarea id="meetingDetails" placeholder="Details" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Details eingeben"></textarea>
                <button onclick="updateMeeting()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2">Aktualisieren</button>
            </div>
        </section>

        <!-- Calendar Section -->
        <section id="calendarSection" class="section hidden">
            <h2 class="text-2xl font-bold mb-6">Kalender</h2>
            <div id="calendar"></div>
            <div id="calendarForm" class="mt-6 hidden">
                <input id="eventTitle" placeholder="Titel" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Titel eingeben">
                <input id="eventDate" type="datetime-local" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Datum und Uhrzeit">
                <textarea id="eventDetails" placeholder="Details" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Details eingeben"></textarea>
                <button onclick="addEvent()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2">Hinzufügen</button>
            </div>
        </section>
    </div>

    <script>
        let isTeamLeader = false;

        // Utility Functions
        const $ = (id) => document.getElementById(id);
        const showError = (id, message) => {
            const errorEl = $(id);
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            setTimeout(() => errorEl.classList.add('hidden'), 3000);
        };

        // PIN Validation
        function checkPin() {
            const pin = $('pinInput').value.trim();
            if (!pin) return showError('pinError', 'Bitte gib einen PIN ein.');
            if (pin === '3571') {
                $('pinModal').classList.add('hidden');
                $('mainContent').classList.remove('hidden');
                $('pinInput').value = '';
            } else {
                showError('pinError', 'Falscher PIN.');
                $('pinInput').value = '';
            }
        }

        function showAdminPinModal() {
            $('adminPinModal').classList.remove('hidden');
            $('adminPinInput').focus();
        }

        function checkAdminPin() {
            const pin = $('adminPinInput').value.trim();
            if (!pin) return showError('adminPinError', 'Bitte gib einen Admin PIN ein.');
            if (pin === '2000') {
                isTeamLeader = true;
                $('adminPinModal').classList.add('hidden');
                $('roleIndicator').textContent = 'Rolle: Teamleiter';
                $('roleIndicator').classList.add('bg-green-100', 'dark:bg-green-800');
                $('announcementForm').classList.remove('hidden');
                $('warningForm').classList.remove('hidden');
                $('meetingForm').classList.remove('hidden');
                $('calendarForm').classList.remove('hidden');
                $('adminPinInput').value = '';
            } else {
                showError('adminPinError', 'Falscher Admin PIN.');
                $('adminPinInput').value = '';
            }
        }

        // Tab Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
            $(sectionId).classList.remove('hidden');
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-gray-500');
            });
            document.querySelector(`button[onclick="showSection('${sectionId}')"]`).classList.add('active');
        }

        // Dark/Light Mode Toggle
        $('toggleDarkMode').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
            $('toggleDarkMode').textContent = document.body.classList.contains('dark-mode') ? 'Light Mode' : 'Dark Mode';
        });

        // Announcements
        function addAnnouncement() {
            if (!isTeamLeader) return showError('announcementList', 'Nur Teamleiter können Ankündigungen hinzufügen.');
            const text = $('announcementText').value.trim();
            if (!text) return showError('announcementList', 'Bitte gib eine Ankündigung ein.');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcements.push({ text, date: new Date().toLocaleString() });
            localStorage.setItem('announcements', JSON.stringify(announcements));
            $('announcementText').value = '';
            renderAnnouncements();
        }

        function renderAnnouncements() {
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            $('announcementList').innerHTML = announcements.length
                ? announcements.map(a => `<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">${a.date}: ${a.text}</div>`).join('')
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Ankündigungen vorhanden.</div>';
        }

        // Team Warnings
        function addWarning() {
            if (!isTeamLeader) return showError('warningList', 'Nur Teamleiter können Warnungen hinzufügen.');
            const member = $('warningMember').value.trim();
            const text = $('warningText').value.trim();
            if (!member || !text) return showError('warningList', 'Bitte gib Teammitglied und Warnung ein.');
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            warnings.push({ member, text, date: new Date().toLocaleString() });
            localStorage.setItem('warnings', JSON.stringify(warnings));
            $('warningMember').value = '';
            $('warningText').value = '';
            renderWarnings();
        }

        function renderWarnings() {
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            $('warningList').innerHTML = warnings.length
                ? warnings.map(w => `<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">${w.date}: ${w.member} - ${w.text}</div>`).join('')
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Warnungen vorhanden.</div>';
        }

        // My Warnings
        function showMyWarnings() {
            const memberName = $('memberNameInput').value.trim();
            if (!memberName) return showError('myWarningList', 'Bitte gib deinen Namen ein.');
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            const myWarnings = warnings.filter(w => w.member.toLowerCase() === memberName.toLowerCase());
            $('myWarningList').innerHTML = myWarnings.length
                ? myWarnings.map(w => `<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">${w.date}: ${w.text}</div>`).join('')
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Warnungen gefunden.</div>';
        }

        // Team Meeting
        function updateMeeting() {
            if (!isTeamLeader) return showError('meetingInfo', 'Nur Teamleiter können Besprechungen aktualisieren.');
            const date = $('meetingDate').value;
            const location = $('meetingLocation').value.trim();
            const details = $('meetingDetails').value.trim();
            if (!date || !location) return showError('meetingInfo', 'Bitte gib Datum und Ort ein.');
            const meeting = { date, location, details, updated: new Date().toLocaleString() };
            localStorage.setItem('meeting', JSON.stringify(meeting));
            renderMeeting();
        }

        function renderMeeting() {
            const meeting = JSON.parse(localStorage.getItem('meeting') || '{}');
            $('meetingInfo').innerHTML = meeting.date
                ? `<p><strong>Datum:</strong> ${new Date(meeting.date).toLocaleString()}</p>
                   <p><strong>Ort:</strong> ${meeting.location}</p>
                   <p><strong>Details:</strong> ${meeting.details || 'Keine Details'}</p>
                   <p class="text-sm text-gray-500 dark:text-gray-400">Zuletzt aktualisiert: ${meeting.updated}</p>`
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Besprechung geplant.</div>';
        }

        // Calendar
        document.addEventListener('DOMContentLoaded', () => {
            const calendar = new FullCalendar.Calendar($('calendar'), {
                initialView: 'dayGridMonth',
                events: JSON.parse(localStorage.getItem('events') || '[]'),
                eventClick: function(info) {
                    alert(`Titel: ${info.event.title}\nDatum: ${info.event.start.toLocaleString()}\nDetails: ${info.event.extendedProps.details || 'Keine Details'}`);
                },
                dateClick: function(info) {
                    if (isTeamLeader) {
                        $('eventDate').value = info.dateStr + 'T12:00';
                        $('eventTitle').focus();
                    }
                }
            });
            calendar.render();
        });

        function addEvent() {
            if (!isTeamLeader) return showError('calendar', 'Nur Teamleiter können Termine hinzufügen.');
            const title = $('eventTitle').value.trim();
            const date = $('eventDate').value;
            const details = $('eventDetails').value.trim();
            if (!title || !date) return showError('calendar', 'Bitte gib Titel und Datum ein.');
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            events.push({ title, start: date, details });
            localStorage.setItem('events', JSON.stringify(events));
            $('eventTitle').value = '';
            $('eventDate').value = '';
            $('eventDetails').value = '';
            location.reload();
        }

        // Initial Render
        renderAnnouncements();
        renderWarnings();
        renderMeeting();

        // Keyboard Accessibility
        ['pinInput', 'adminPinInput'].forEach(id => {
            $(id).addEventListener('keypress', (e) => {
                if (e.key === 'Enter') id === 'pinInput' ? checkPin() : checkAdminPin();
            });
        });
    </script>
</body>
</html>