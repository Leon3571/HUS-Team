<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Management Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FullCalendar CDN -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: #0f172a;
            color: #cbd5e1;
        }
        .light-mode {
            background-color: #f1f5f9;
            color: #1e293b;
        }
        #calendar {
            max-width: 1000px;
            margin: 2rem auto;
        }
        .error {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .tab-button.active {
            color: #1d4ed8;
            border-bottom: 3px solid #1d4ed8;
            font-weight: 600;
        }
        .btn {
            @apply px-4 py-2 rounded-lg font-semibold transition duration-200 ease-in-out;
        }
        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700;
        }
        .btn-secondary {
            @apply bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600;
        }
        .btn-success {
            @apply bg-green-600 text-white hover:bg-green-700;
        }
        .btn-warning {
            @apply bg-yellow-500 text-white hover:bg-yellow-600;
        }
        .card {
            @apply bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6;
        }
    </style>
</head>
<body class="light-mode min-h-screen">
    <!-- PIN Login Modal -->
    <div id="pinModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="card w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-6 text-center">Portal-Zugang</h2>
            <input id="pinInput" type="password" placeholder="PIN eingeben" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="PIN für Portal-Zugang">
            <p id="pinError" class="error hidden">Falscher PIN oder leere Eingabe.</p>
            <button onclick="checkPin()" class="btn btn-primary w-full mt-4" aria-label="Anmelden">Anmelden</button>
        </div>
    </div>

    <!-- Admin PIN Modal -->
    <div id="adminPinModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="card w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-6 text-center">Teamleiter-Zugang</h2>
            <input id="adminPinInput" type="password" placeholder="Admin PIN eingeben" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="PIN für Teamleiter-Zugang">
            <p id="adminPinError" class="error hidden">Falscher Admin PIN oder leere Eingabe.</p>
            <button onclick="checkAdminPin()" class="btn btn-primary w-full mt-4" aria-label="Bestätigen">Bestätigen</button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="container mx-auto p-6 hidden">
        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Team Management Portal</h1>
            <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                <button id="toggleDarkMode" class="btn btn-secondary" aria-label="Dark/Light Mode umschalten">Dark Mode</button>
                <button id="adminAccessBtn" onclick="showAdminPinModal()" class="btn btn-success hidden" aria-label="Teamleiter-Zugriff">Teamleiter-Zugriff</button>
                <button id="switchToMemberBtn" onclick="switchToMember()" class="btn btn-warning hidden" aria-label="Zu Teammitglied wechseln">Zu Teammitglied</button>
                <span id="roleIndicator" class="text-sm font-semibold px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300" aria-live="polite">Rolle: Teammitglied</span>
            </div>
        </header>

        <!-- Tabs -->
        <nav id="navTabs" class="flex space-x-6 mb-8 border-b border-gray-200 dark:border-gray-700">
            <button onclick="showSection('announcements')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-600 transition active" aria-label="Ankündigungen anzeigen">Ankündigungen</button>
            <button id="teamWarningsTab" onclick="showSection('teamWarnings')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-600 transition hidden" aria-label="Team Warns anzeigen">Team Warns</button>
            <button onclick="showSection('myWarnings')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-600 transition" aria-label="Meine Warns anzeigen">Meine Warns</button>
            <button onclick="showSection('teamMeeting')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-600 transition" aria-label="Team Besprechung anzeigen">Team Besprechung</button>
            <button onclick="showSection('rollenuebersicht')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-600 transition" aria-label="Rollenübersicht anzeigen">Rollenübersicht</button>
            <button onclick="showSection('calendar')" class="tab-button px-4 py-2 font-semibold text-gray-500 hover:text-blue-600 transition" aria-label="Kalender anzeigen">Kalender</button>
        </nav>

        <!-- Announcements Section -->
        <section id="announcements" class="section card">
            <h2 class="text-2xl font-bold mb-6">Ankündigungen</h2>
            <div id="announcementList" class="space-y-4"></div>
            <div id="announcementForm" class="mt-6 hidden">
                <textarea id="announcementText" placeholder="Neue Ankündigung" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Ankündigung eingeben"></textarea>
                <p id="announcementError" class="error hidden">Bitte gib eine Ankündigung ein.</p>
                <button onclick="addAnnouncement()" class="btn btn-primary mt-3" aria-label="Ankündigung hinzufügen">Hinzufügen</button>
            </div>
        </section>

        <!-- Team Warnings Section -->
        <section id="teamWarnings" class="section card hidden">
            <h2 class="text-2xl font-bold mb-6">Team Warns</h2>
            <div id="warningList" class="space-y-4"></div>
            <div id="warningForm" class="mt-6 hidden">
                <input id="warningMember" placeholder="Teammitglied" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Teammitglied eingeben">
                <textarea id="warningText" placeholder="Warnung" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Warnung eingeben"></textarea>
                <p id="warningError" class="error hidden">Bitte gib Teammitglied und Warnung ein.</p>
                <button onclick="addWarning()" class="btn btn-primary mt-3" aria-label="Warnung hinzufügen">Hinzufügen</button>
            </div>
        </section>

        <!-- My Warnings Section -->
        <section id="myWarnings" class="section card hidden">
            <h2 class="text-2xl font-bold mb-6">Meine Warns</h2>
            <input id="memberNameInput" placeholder="Deinen Namen eingeben" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Name eingeben">
            <p id="myWarningsError" class="error hidden">Bitte gib deinen Namen ein.</p>
            <button onclick="showMyWarnings()" class="btn btn-primary" aria-label="Meine Warns anzeigen">Warns anzeigen</button>
            <div id="myWarningList" class="space-y-4 mt-6"></div>
        </section>

        <!-- Team Meeting Section -->
        <section id="teamMeeting" class="section card hidden">
            <h2 class="text-2xl font-bold mb-6">Team Besprechung</h2>
            <div id="meetingInfo" class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg"></div>
            <div id="meetingForm" class="mt-6 hidden">
                <input id="meetingDate" type="datetime-local" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Datum und Uhrzeit">
                <input id="meetingLocation" placeholder="Ort" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Ort eingeben">
                <textarea id="meetingDetails" placeholder="Details" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Details eingeben"></textarea>
                <p id="meetingError" class="error hidden">Bitte gib Datum und Ort ein.</p>
                <button onclick="updateMeeting()" class="btn btn-primary mt-3" aria-label="Besprechung aktualisieren">Aktualisieren</button>
            </div>
        </section>

        <!-- Rollenübersicht Section -->
        <section id="rollenuebersicht" class="section card hidden">
            <h2 class="text-2xl font-bold mb-6">Rollenübersicht</h2>
            <div id="roleList" class="space-y-4"></div>
            <div id="roleForm" class="mt-6 hidden">
                <input id="roleMember" placeholder="Teammitglied" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Teammitglied eingeben">
                <input id="roleTitle" placeholder="Rolle" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Rolle eingeben">
                <p id="roleError" class="error hidden">Bitte gib Teammitglied und Rolle ein.</p>
                <button onclick="addRole()" class="btn btn-primary mt-3" aria-label="Rolle hinzufügen">Hinzufügen</button>
            </div>
        </section>

        <!-- Calendar Section -->
        <section id="calendarSection" class="section hidden">
            <h2 class="text-2xl font-bold mb-6">Kalender</h2>
            <div id="calendar" class="card"></div>
            <div id="calendarForm" class="mt-6 card hidden">
                <input id="eventTitle" placeholder="Titel" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Titel eingeben">
                <input id="eventDate" type="datetime-local" class="w-full p-3 border rounded-lg mb-3 bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Datum und Uhrzeit">
                <textarea id="eventDetails" placeholder="Details" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" aria-label="Details eingeben"></textarea>
                <p id="calendarError" class="error hidden">Bitte gib Titel und Datum ein.</p>
                <button onclick="addEvent()" class="btn btn-primary mt-3" aria-label="Termin hinzufügen">Hinzufügen</button>
            </div>
        </section>
    </div>

    <script>
        let isTeamLeader = false;
        const $ = (id) => document.getElementById(id);

        // Error Handling
        const showError = (id, message) => {
            const errorEl = $(id);
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            setTimeout(() => errorEl.classList.add('hidden'), 3000);
        };

        // PIN Validation
        function checkPin() {
            const pin = $('pinInput').value.trim();
            if (!pin) return showError('pinError', 'Bitte gib einen PIN ein.');
            if (pin === '3571') {
                $('pinModal').classList.add('hidden');
                $('mainContent').classList.remove('hidden');
                $('pinInput').value = '';
                showSection('announcements');
                $('adminAccessBtn').classList.remove('hidden');
            } else {
                showError('pinError', 'Falscher PIN.');
                $('pinInput').value = '';
            }
        }

        function showAdminPinModal() {
            $('adminPinModal').classList.remove('hidden');
            $('adminPinInput').focus();
        }

        function checkAdminPin() {
            const pin = $('adminPinInput').value.trim();
            if (!pin) return showError('adminPinError', 'Bitte gib einen Admin PIN ein.');
            if (pin === '2000') {
                isTeamLeader = true;
                $('adminPinModal').classList.add('hidden');
                $('roleIndicator').textContent = 'Rolle: Teamleiter';
                $('roleIndicator').classList.remove('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
                $('roleIndicator').classList.add('bg-green-100', 'text-green-700', 'dark:bg-green-800', 'dark:text-green-200');
                ['announcementForm', 'warningForm', 'meetingForm', 'calendarForm', 'roleForm', 'teamWarningsTab'].forEach(id => $(id).classList.remove('hidden'));
                $('adminAccessBtn').classList.add('hidden');
                $('switchToMemberBtn').classList.remove('hidden');
                $('adminPinInput').value = '';
            } else {
                showError('adminPinError', 'Falscher Admin PIN.');
                $('adminPinInput').value = '';
            }
        }

        function switchToMember() {
            isTeamLeader = false;
            $('roleIndicator').textContent = 'Rolle: Teammitglied';
            $('roleIndicator').classList.remove('bg-green-100', 'text-green-700', 'dark:bg-green-800', 'dark:text-green-200');
            $('roleIndicator').classList.add('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
            ['announcementForm', 'warningForm', 'meetingForm', 'calendarForm', 'roleForm', 'teamWarningsTab', 'teamWarnings'].forEach(id => $(id).classList.add('hidden'));
            $('adminAccessBtn').classList.remove('hidden');
            $('switchToMemberBtn').classList.add('hidden');
            showSection('announcements');
        }

        // Tab Navigation
        function showSection(sectionId) {
            if (sectionId === 'teamWarnings' && !isTeamLeader) return;
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            $(sectionId).classList.remove('hidden');
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-blue-600');
                btn.classList.add('text-gray-500');
            });
            document.querySelector(`button[onclick="showSection('${sectionId}')"]`).classList.add('active', 'text-blue-600');
        }

        // Dark/Light Mode Toggle
        $('toggleDarkMode').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
            $('toggleDarkMode').textContent = document.body.classList.contains('dark-mode') ? 'Light Mode' : 'Dark Mode';
        });

        // Announcements
        function addAnnouncement() {
            if (!isTeamLeader) return showError('announcementError', 'Nur Teamleiter können Ankündigungen hinzufügen.');
            const text = $('announcementText').value.trim();
            if (!text) return showError('announcementError', 'Bitte gib eine Ankündigung ein.');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcements.push({ text, date: new Date().toLocaleString('de-DE') });
            localStorage.setItem('announcements', JSON.stringify(announcements));
            $('announcementText').value = '';
            renderAnnouncements();
        }

        function renderAnnouncements() {
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            $('announcementList').innerHTML = announcements.length
                ? announcements.map(a => `<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">${a.date}: ${a.text}</div>`).join('')
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Ankündigungen vorhanden.</div>';
        }

        // Team Warnings
        function addWarning() {
            if (!isTeamLeader) return showError('warningError', 'Nur Teamleiter können Warnungen hinzufügen.');
            const member = $('warningMember').value.trim();
            const text = $('warningText').value.trim();
            if (!member || !text) return showError('warningError', 'Bitte gib Teammitglied und Warnung ein.');
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            warnings.push({ member, text, date: new Date().toLocaleString('de-DE') });
            localStorage.setItem('warnings', JSON.stringify(warnings));
            $('warningMember').value = '';
            $('warningText').value = '';
            renderWarnings();
        }

        function renderWarnings() {
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            $('warningList').innerHTML = warnings.length
                ? warnings.map(w => `<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">${w.date}: ${w.member} - ${w.text}</div>`).join('')
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Warnungen vorhanden.</div>';
        }

        // My Warnings
        function showMyWarnings() {
            const memberName = $('memberNameInput').value.trim();
            if (!memberName) return showError('myWarningsError', 'Bitte gib deinen Namen ein.');
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            const myWarnings = warnings.filter(w => w.member.toLowerCase() === memberName.toLowerCase());
            $('myWarningList').innerHTML = myWarnings.length
                ? myWarnings.map(w => `<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">${w.date}: ${w.text}</div>`).join('')
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Warnungen gefunden.</div>';
        }

        // Team Meeting
        function updateMeeting() {
            if (!isTeamLeader) return showError('meetingError', 'Nur Teamleiter können Besprechungen aktualisieren.');
            const date = $('meetingDate').value;
            const location = $('meetingLocation').value.trim();
            const details = $('meetingDetails').value.trim();
            if (!date || !location) return showError('meetingError', 'Bitte gib Datum und Ort ein.');
            const meeting = { date, location, details, updated: new Date().toLocaleString('de-DE') };
            localStorage.setItem('meeting', JSON.stringify(meeting));
            $('meetingDate').value = '';
            $('meetingLocation').value = '';
            $('meetingDetails').value = '';
            renderMeeting();
        }

        function renderMeeting() {
            const meeting = JSON.parse(localStorage.getItem('meeting') || '{}');
            $('meetingInfo').innerHTML = meeting.date
                ? `<p><strong>Datum:</strong> ${new Date(meeting.date).toLocaleString('de-DE')}</p>
                   <p><strong>Ort:</strong> ${meeting.location}</p>
                   <p><strong>Details:</strong> ${meeting.details || 'Keine Details'}</p>
                   <p class="text-sm text-gray-500 dark:text-gray-400">Zuletzt aktualisiert: ${meeting.updated}</p>`
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Besprechung geplant.</div>';
        }

        // Rollenübersicht
        function addRole() {
            if (!isTeamLeader) return showError('roleError', 'Nur Teamleiter können Rollen hinzufügen.');
            const member = $('roleMember').value.trim();
            const role = $('roleTitle').value.trim();
            if (!member || !role) return showError('roleError', 'Bitte gib Teammitglied und Rolle ein.');
            const roles = JSON.parse(localStorage.getItem('roles') || '[]');
            roles.push({ member, role, date: new Date().toLocaleString('de-DE') });
            localStorage.setItem('roles', JSON.stringify(roles));
            $('roleMember').value = '';
            $('roleTitle').value = '';
            renderRoles();
        }

        function renderRoles() {
            const roles = JSON.parse(localStorage.getItem('roles') || '[]');
            $('roleList').innerHTML = roles.length
                ? roles.map(r => `<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">${r.date}: ${r.member} - ${r.role}</div>`).join('')
                : '<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">Keine Rollen zugewiesen.</div>';
        }

        // Calendar
        document.addEventListener('DOMContentLoaded', () => {
            const calendar = new FullCalendar.Calendar($('calendar'), {
                initialView: 'dayGridMonth',
                locale: 'de',
                events: JSON.parse(localStorage.getItem('events') || '[]'),
                eventClick: function(info) {
                    alert(`Titel: ${info.event.title}\nDatum: ${info.event.start.toLocaleString('de-DE')}\nDetails: ${info.event.extendedProps.details || 'Keine Details'}`);
                },
                dateClick: function(info) {
                    if (isTeamLeader) {
                        $('eventDate').value = info.dateStr + 'T12:00';
                        $('eventTitle').focus();
                    }
                },
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                }
            });
            calendar.render();
        });

        function addEvent() {
            if (!isTeamLeader) return showError('calendarError', 'Nur Teamleiter können Termine hinzufügen.');
            const title = $('eventTitle').value.trim();
            const date = $('eventDate').value;
            const details = $('eventDetails').value.trim();
            if (!title || !date) return showError('calendarError', 'Bitte gib Titel und Datum ein.');
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            events.push({ title, start: date, details });
            localStorage.setItem('events', JSON.stringify(events));
            $('eventTitle').value = '';
            $('eventDate').value = '';
            $('eventDetails').value = '';
            location.reload();
        }

        // Initial Render
        renderAnnouncements();
        renderWarnings();
        renderMeeting();
        renderRoles();

        // Keyboard Accessibility
        ['pinInput', 'adminPinInput'].forEach(id => {
            $(id).addEventListener('keypress', (e) => {
                if (e.key === 'Enter') id === 'pinInput' ? checkPin() : checkAdminPin();
            });
        });
    </script>
</body>
</html>