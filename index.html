<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Management Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: #1e3a8a;
            color: #dbeafe;
        }
        .light-mode {
            background-color: #e0f2fe;
            color: #1e40af;
        }
        .card {
            @apply bg-white dark:bg-blue-900 rounded-2xl shadow-xl p-6 transform transition hover:scale-105;
        }
        .error {
            color: #f87171;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .tab-button.active {
            color: #3b82f6;
            border-bottom: 3px solid #3b82f6;
            @apply font-bold;
        }
        .btn {
            @apply px-4 py-2 rounded-lg transition transform hover:scale-105;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .section {
            animation: fadeIn 0.5s ease-in-out;
        }
    </style>
</head>
<body class="light-mode min-h-screen">
    <!-- PIN Login Modal -->
    <div id="pinModal" class="fixed inset-0 bg-blue-900 bg-opacity-80 flex items-center justify-center z-50">
        <div class="card w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-6 text-center text-blue-800 dark:text-blue-200">Willkommen!</h2>
            <input id="pinInput" type="password" placeholder="PIN eingeben" class="w-full p-3 border border-blue-300 rounded-lg bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" aria-label="PIN für Portal-Zugang">
            <p id="pinError" class="error hidden">Falscher PIN oder leere Eingabe.</p>
            <button onclick="checkPin()" class="btn w-full bg-blue-500 text-white hover:bg-blue-600 mt-4" aria-label="Anmelden">Anmelden</button>
        </div>
    </div>

    <!-- Admin PIN Modal -->
    <div id="adminPinModal" class="fixed inset-0 bg-blue-900 bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="card w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-6 text-center text-blue-800 dark:text-blue-200">Teamleiter-Zugang</h2>
            <input id="adminPinInput" type="password" placeholder="Admin PIN eingeben" class="w-full p-3 border border-blue-300 rounded-lg bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" aria-label="PIN für Teamleiter-Zugang">
            <p id="adminPinError" class="error hidden">Falscher Admin PIN oder leere Eingabe.</p>
            <button onclick="checkAdminPin()" class="btn w-full bg-blue-500 text-white hover:bg-blue-600 mt-4" aria-label="Bestätigen">Bestätigen</button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="container mx-auto p-8 hidden">
        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-10">
            <h1 class="text-4xl font-extrabold text-blue-700 dark:text-blue-300">Team Portal</h1>
            <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                <button id="toggleDarkMode" class="btn bg-blue-200 dark:bg-blue-700 text-blue-800 dark:text-blue-200 hover:bg-blue-300 dark:hover:bg-blue-600" aria-label="Dark/Light Mode umschalten">Dark Mode</button>
                <button id="adminAccessBtn" onclick="showAdminPinModal()" class="btn bg-green-500 text-white hover:bg-green-600" aria-label="Teamleiter-Zugriff">Teamleiter-Zugriff</button>
                <span id="roleIndicator" class="text-sm font-semibold px-4 py-2 rounded-full bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-200" aria-live="polite">Rolle: Teammitglied</span>
            </div>
        </header>

        <!-- Tabs -->
        <nav class="flex flex-wrap gap-4 mb-10 border-b-2 border-blue-200 dark:border-blue-700">
            <button onclick="showSection('announcements')" class="tab-button px-6 py-3 font-semibold text-blue-600 dark:text-blue-300 hover:text-blue-800 dark:hover:text-blue-100 transition active" aria-label="Ankündigungen anzeigen">Ankündigungen</button>
            <button onclick="showSection('teamWarnings')" class="tab-button px-6 py-3 font-semibold text-blue-600 dark:text-blue-300 hover:text-blue-800 dark:hover:text-blue-100 transition" aria-label="Team Warns anzeigen">Team Warns</button>
            <button onclick="showSection('myWarnings')" class="tab-button px-6 py-3 font-semibold text-blue-600 dark:text-blue-300 hover:text-blue-800 dark:hover:text-blue-100 transition" aria-label="Meine Warns anzeigen">Meine Warns</button>
            <button onclick="showSection('teamMeeting')" class="tab-button px-6 py-3 font-semibold text-blue-600 dark:text-blue-300 hover:text-blue-800 dark:hover:text-blue-100 transition" aria-label="Team Besprechung anzeigen">Team Besprechung</button>
        </nav>

        <!-- Announcements Section -->
        <section id="announcements" class="section card">
            <h2 class="text-2xl font-bold mb-6 text-blue-700 dark:text-blue-300">Ankündigungen</h2>
            <div id="announcementList" class="space-y-4"></div>
            <div id="announcementForm" class="mt-6 hidden">
                <textarea id="announcementText" placeholder="Neue Ankündigung" class="w-full p-4 border border-blue-300 rounded-lg bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" rows="5" aria-label="Ankündigung eingeben"></textarea>
                <p id="announcementError" class="error hidden">Bitte gib eine Ankündigung ein.</p>
                <button onclick="addAnnouncement()" class="btn bg-blue-500 text-white hover:bg-blue-600 mt-3" aria-label="Ankündigung hinzufügen">Hinzufügen</button>
            </div>
        </section>

        <!-- Team Warnings Section -->
        <section id="teamWarnings" class="section card hidden">
            <h2 class="text-2xl font-bold mb-6 text-blue-700 dark:text-blue-300">Team Warns</h2>
            <div id="warningList" class="space-y-4"></div>
            <div id="warningForm" class="mt-6 hidden">
                <input id="warningMember" placeholder="Teammitglied" class="w-full p-4 border border-blue-300 rounded-lg mb-3 bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" aria-label="Teammitglied eingeben">
                <textarea id="warningText" placeholder="Warnung" class="w-full p-4 border border-blue-300 rounded-lg bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" rows="5" aria-label="Warnung eingeben"></textarea>
                <p id="warningError" class="error hidden">Bitte gib Teammitglied und Warnung ein.</p>
                <button onclick="addWarning()" class="btn bg-blue-500 text-white hover:bg-blue-600 mt-3" aria-label="Warnung hinzufügen">Hinzufügen</button>
            </div>
        </section>

        <!-- My Warnings Section -->
        <section id="myWarnings" class="section card hidden">
            <h2 class="text-2xl font-bold mb-6 text-blue-700 dark:text-blue-300">Meine Warns</h2>
            <input id="memberNameInput" placeholder="Deinen Namen eingeben" class="w-full p-4 border border-blue-300 rounded-lg mb-3 bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" aria-label="Name eingeben">
            <p id="myWarningsError" class="error hidden">Bitte gib deinen Namen ein.</p>
            <button onclick="showMyWarnings()" class="btn bg-blue-500 text-white hover:bg-blue-600" aria-label="Meine Warns anzeigen">Warns anzeigen</button>
            <div id="myWarningList" class="space-y-4 mt-6"></div>
        </section>

        <!-- Team Meeting Section -->
        <section id="teamMeeting" class="section card hidden">
            <h2 class="text-2xl font-bold mb-6 text-blue-700 dark:text-blue-300">Team Besprechung</h2>
            <div id="meetingInfo" class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg"></div>
            <div id="meetingForm" class="mt-6 hidden">
                <input id="meetingDate" type="datetime-local" class="w-full p-4 border border-blue-300 rounded-lg mb-3 bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" aria-label="Datum und Uhrzeit">
                <input id="meetingLocation" placeholder="Ort" class="w-full p-4 border border-blue-300 rounded-lg mb-3 bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" aria-label="Ort eingeben">
                <textarea id="meetingDetails" placeholder="Details" class="w-full p-4 border border-blue-300 rounded-lg bg-blue-50 dark:bg-blue-800 dark:text-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" rows="5" aria-label="Details eingeben"></textarea>
                <p id="meetingError" class="error hidden">Bitte gib Datum und Ort ein.</p>
                <button onclick="updateMeeting()" class="btn bg-blue-500 text-white hover:bg-blue-600 mt-3" aria-label="Besprechung aktualisieren">Aktualisieren</button>
            </div>
        </section>
    </div>

    <script>
        let isTeamLeader = false;
        const $ = (id) => document.getElementById(id);

        // Error Handling
        const showError = (id, message) => {
            const errorEl = $(id);
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            setTimeout(() => errorEl.classList.add('hidden'), 3000);
        };

        // PIN Validation
        function checkPin() {
            const pin = $('pinInput').value.trim();
            if (!pin) return showError('pinError', 'Bitte gib einen PIN ein.');
            if (pin === '3571') {
                $('pinModal').classList.add('hidden');
                $('mainContent').classList.remove('hidden');
                $('pinInput').value = '';
                showSection('announcements');
            } else {
                showError('pinError', 'Falscher PIN.');
                $('pinInput').value = '';
            }
        }

        function showAdminPinModal() {
            $('adminPinModal').classList.remove('hidden');
            $('adminPinInput').focus();
        }

        function checkAdminPin() {
            const pin = $('adminPinInput').value.trim();
            if (!pin) return showError('adminPinError', 'Bitte gib einen Admin PIN ein.');
            if (pin === '2000') {
                isTeamLeader = true;
                $('adminPinModal').classList.add('hidden');
                $('roleIndicator').textContent = 'Rolle: Teamleiter';
                $('roleIndicator').classList.remove('bg-blue-100', 'text-blue-700', 'dark:bg-blue-800', 'dark:text-blue-200');
                $('roleIndicator').classList.add('bg-green-200', 'text-green-800', 'dark:bg-green-800', 'dark:text-green-200');
                ['announcementForm', 'warningForm', 'meetingForm'].forEach(id => $(id).classList.remove('hidden'));
                $('adminPinInput').value = '';
                renderWarnings(); // Refresh warnings to show delete buttons
            } else {
                showError('adminPinError', 'Falscher Admin PIN.');
                $('adminPinInput').value = '';
            }
        }

        // Tab Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            $(sectionId).classList.remove('hidden');
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-blue-800', 'dark:text-blue-100');
                btn.classList.add('text-blue-600', 'dark:text-blue-300');
            });
            document.querySelector(`button[onclick="showSection('${sectionId}')"]`).classList.add('active', 'text-blue-800', 'dark:text-blue-100');
        }

        // Dark/Light Mode Toggle
        $('toggleDarkMode').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
            $('toggleDarkMode').textContent = document.body.classList.contains('dark-mode') ? 'Light Mode' : 'Dark Mode';
        });

        // Announcements
        function addAnnouncement() {
            if (!isTeamLeader) return showError('announcementError', 'Nur Teamleiter können Ankündigungen hinzufügen.');
            const text = $('announcementText').value.trim();
            if (!text) return showError('announcementError', 'Bitte gib eine Ankündigung ein.');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcements.push({ text, date: new Date().toLocaleString('de-DE') });
            localStorage.setItem('announcements', JSON.stringify(announcements));
            $('announcementText').value = '';
            renderAnnouncements();
        }

        function renderAnnouncements() {
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            $('announcementList').innerHTML = announcements.length
                ? announcements.map(a => `<div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg">${a.date}: ${a.text}</div>`).join('')
                : '<div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg">Keine Ankündigungen vorhanden.</div>';
        }

        // Team Warnings
        function addWarning() {
            if (!isTeamLeader) return showError('warningError', 'Nur Teamleiter können Warnungen hinzufügen.');
            const member = $('warningMember').value.trim();
            const text = $('warningText').value.trim();
            if (!member || !text) return showError('warningError', 'Bitte gib Teammitglied und Warnung ein.');
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            warnings.push({ id: Date.now(), member, text, date: new Date().toLocaleString('de-DE') });
            localStorage.setItem('warnings', JSON.stringify(warnings));
            $('warningMember').value = '';
            $('warningText').value = '';
            renderWarnings();
        }

        function deleteWarning(id) {
            if (!isTeamLeader) return showError('warningError', 'Nur Teamleiter können Warnungen entfernen.');
            let warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            warnings = warnings.filter(w => w.id !== id);
            localStorage.setItem('warnings', JSON.stringify(warnings));
            renderWarnings();
        }

        function renderWarnings() {
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            $('warningList').innerHTML = warnings.length
                ? warnings.map(w => `
                    <div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg flex justify-between items-center">
                        <div>${w.date}: ${w.member} - ${w.text}</div>
                        ${isTeamLeader ? `<button onclick="deleteWarning(${w.id})" class="btn bg-red-500 text-white hover:bg-red-600" aria-label="Warnung entfernen">Entfernen</button>` : ''}
                    </div>`).join('')
                : '<div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg">Keine Warnungen vorhanden.</div>';
        }

        // My Warnings
        function showMyWarnings() {
            const memberName = $('memberNameInput').value.trim();
            if (!memberName) return showError('myWarningsError', 'Bitte gib deinen Namen ein.');
            const warnings = JSON.parse(localStorage.getItem('warnings') || '[]');
            const myWarnings = warnings.filter(w => w.member.toLowerCase() === memberName.toLowerCase());
            $('myWarningList').innerHTML = myWarnings.length
                ? myWarnings.map(w => `<div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg">${w.date}: ${w.text}</div>`).join('')
                : '<div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg">Keine Warnungen gefunden.</div>';
        }

        // Team Meeting
        function updateMeeting() {
            if (!isTeamLeader) return showError('meetingError', 'Nur Teamleiter können Besprechungen aktualisieren.');
            const date = $('meetingDate').value;
            const location = $('meetingLocation').value.trim();
            const details = $('meetingDetails').value.trim();
            if (!date || !location) return showError('meetingError', 'Bitte gib Datum und Ort ein.');
            const meeting = { date, location, details, updated: new Date().toLocaleString('de-DE') };
            localStorage.setItem('meeting', JSON.stringify(meeting));
            $('meetingDate').value = '';
            $('meetingLocation').value = '';
            $('meetingDetails').value = '';
            renderMeeting();
        }

        function renderMeeting() {
            const meeting = JSON.parse(localStorage.getItem('meeting') || '{}');
            $('meetingInfo').innerHTML = meeting.date
                ? `<p><strong>Datum:</strong> ${new Date(meeting.date).toLocaleString('de-DE')}</p>
                   <p><strong>Ort:</strong> ${meeting.location}</p>
                   <p><strong>Details:</strong> ${meeting.details || 'Keine Details'}</p>
                   <p class="text-sm text-blue-600 dark:text-blue-300">Zuletzt aktualisiert: ${meeting.updated}</p>`
                : '<div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-lg">Keine Besprechung geplant.</div>';
        }

        // Initial Render
        renderAnnouncements();
        renderWarnings();
        renderMeeting();

        // Keyboard Accessibility
        ['pinInput', 'adminPinInput'].forEach(id => {
            $(id).addEventListener('keypress', (e) => {
                if (e.key === 'Enter') id === 'pinInput' ? checkPin() : checkAdminPin();
            });
        });
    </script>
</body>
</html>